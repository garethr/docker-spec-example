box: wercker-labs/docker
build:
  steps:
    - install-packages:
        packages: ruby1.9.1-dev
    - script:
        name: print the ruby version
        code: ruby --version | tee $WERCKER_REPORT_MESSAGE_FILE
    - script:
        name: install bundler
        code: sudo gem install bundler
    - bundle-install
    - script:
        name: print the docker version
        code: docker version | tee $WERCKER_REPORT_MESSAGE_FILE
    - script:
        name: create the docker image
        code: docker build -t garethr/nginx .
    - script:
        name: run a docker container based on the image
        code: docker run garethr/nginx --name test
    - script:
        name: find port to test
        code: docker port test 80
    - script:
        name: run the test suite
        code: bundle exec rspec
